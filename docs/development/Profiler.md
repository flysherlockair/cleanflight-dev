# Sampling profiler

For analyzing code speed during development, a sampling profiler feature can be included. The profiler triggers an
interrupt at 1KHz which samples the current instruction pointer. This creates a profile log which is transmitted on
a configured serial port for logging and analysis.

The log can be used to measure the percentage of time spent on each line of the program.

**Caution, this feature is not intended for flight. Do not attach propellers.**

## Compatibility

The profiler uses the same timer that SOFTSERIAL and LEDSTRIP would normally use, so neither of those features may be
enabled at the same time as you are profiling.

## Usage

In the target.h file for your board, uncomment the `//#define USE_PROFILER` line to enable the profiler, rebuild the
firmware, and flash it to your board. Keep a copy of the `obj/main/cleanflight_*.elf` file that is generated by compilation,
because you will need it in order to interpret logs recorded with your version of the firmware.

On the CLI tab, enable the PROFILER feature:

```
feature PROFILER
```

Decide which serial port you want the profiler to send its log to. Check the current configuration of that port with
the `serial` command:

```
# serial
serial 0 1 115200 57600 0 115200 115200
```

This is UART1 (port index 0) which I want to share between MSP and the profiler. The second number is the functions 
assigned to the port. The profiler is function number 256, so add 256 to the "1" that's already there (for MSP).
The final setting is the profiler baud rate, I choose 230400: 

```
serial 0 257 115200 57600 0 115200 230400
```

Save your changes and exit:

```
save
```

The profiler will begin logging when you arm your craft. You can use an OpenLog or similar device to record the log.